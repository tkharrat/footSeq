---

title: `Event` Embedded Document


keywords: fastai
sidebar: home_sidebar



nb_path: "01_2_possessions_data_structure.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_2_possessions_data_structure.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.debugger</span> <span class="kn">import</span> <span class="n">set_trace</span>
<span class="kn">from</span> <span class="nn">IPython.utils</span> <span class="kn">import</span> <span class="n">traitlets</span> <span class="k">as</span> <span class="n">_traitlets</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/tmp/ipykernel_519189/2943078347.py:2: UserWarning: IPython.utils.traitlets has moved to a top-level traitlets package.
  from IPython.utils import traitlets as _traitlets
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1><center> Possessions Data Structure </center></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this module, we provide a class mapping between the <code>Possessions</code> document in <code>mongoDB</code> and python.</p>
<p>The <code>Possessions</code> document has a nested structure with:</p>
<ul>
<li>some metadata: <code>gameId</code>, <code>possNumber</code>, <code>target</code> and a unique document <code>_id</code></li>
<li>a List of events stored in the <code>sequence</code> field</li>
</ul>
<p>The strategy therefore is to define first an <code>event</code> <code>mongoengine.EmbeddedDocument</code> and then the <a href="/footSeq/2_possessions_data_structure.html#Possession"><code>Possession</code></a> <code>mongoengine.Document</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Event" class="doc_header"><code>class</code> <code>Event</code><a href="https://github.com/tkharrat/footSeq/tree/master/footSeq/datastruct/possessions.py#L16" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Event</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>EmbeddedDocument</code></p>
</blockquote>
<p>Event mapping class to store event info stored in the <code>sequence</code> field</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="The-Possession-Document">The <a href="/footSeq/2_possessions_data_structure.html#Possession"><code>Possession</code></a> Document<a class="anchor-link" href="#The-Possession-Document"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Possession" class="doc_header"><code>class</code> <code>Possession</code><a href="https://github.com/tkharrat/footSeq/tree/master/footSeq/datastruct/possessions.py#L121" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Possession</code>(<strong>*<code>args</code></strong>, <strong>**<code>values</code></strong>) :: <code>Document</code></p>
</blockquote>
<p>Store the <a href="/footSeq/2_possessions_data_structure.html#Possession"><code>Possession</code></a> document info</p>
<h2 id="Attributes">Attributes<a class="anchor-link" href="#Attributes"> </a></h2><p>_id : str
    unique document identifier
gameId : int
    game-identifier
possNumber : int
    possession number
target : str
    whether the possession ended up in a <code>goal</code> or <code>no-goal</code>
"sequence": List[Event]
    list of event information</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">footSeq.config.mongo</span> <span class="kn">import</span> <span class="n">mongo_init</span>

<span class="n">mongo_init</span><span class="p">(</span><span class="s2">&quot;prod_atlas&quot;</span><span class="p">)</span>

<span class="n">poss</span> <span class="o">=</span> <span class="n">Possession</span><span class="o">.</span><span class="n">get_all_game_poss</span><span class="p">(</span><span class="n">gm_id</span><span class="o">=</span><span class="mi">1998205</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">poss</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gameId</th>
      <th>possessionNumber</th>
      <th>target</th>
      <th>sequence</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1998205</td>
      <td>1</td>
      <td>no-goal</td>
      <td>event_id orig_event_id  player_id          ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1998205</td>
      <td>2</td>
      <td>no-goal</td>
      <td>event_id orig_event_id  player_id         ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1998205</td>
      <td>3</td>
      <td>no-goal</td>
      <td>event_id orig_event_id  player_id          ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1998205</td>
      <td>4</td>
      <td>no-goal</td>
      <td>event_id orig_event_id player_id          ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1998205</td>
      <td>5</td>
      <td>no-goal</td>
      <td>event_id orig_event_id  player_id         ...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>151</th>
      <td>1998205</td>
      <td>154</td>
      <td>no-goal</td>
      <td>event_id orig_event_id  player_id          ...</td>
    </tr>
    <tr>
      <th>152</th>
      <td>1998205</td>
      <td>155</td>
      <td>no-goal</td>
      <td>event_id orig_event_id  player_id         ...</td>
    </tr>
    <tr>
      <th>153</th>
      <td>1998205</td>
      <td>156</td>
      <td>no-goal</td>
      <td>event_id orig_event_id  player_id          ...</td>
    </tr>
    <tr>
      <th>154</th>
      <td>1998205</td>
      <td>157</td>
      <td>no-goal</td>
      <td>event_id orig_event_id player_id           ...</td>
    </tr>
    <tr>
      <th>155</th>
      <td>1998205</td>
      <td>158</td>
      <td>no-goal</td>
      <td>event_id orig_event_id player_id          ...</td>
    </tr>
  </tbody>
</table>
<p>156 rows × 4 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">poss</span><span class="o">.</span><span class="n">sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_id</th>
      <th>orig_event_id</th>
      <th>player_id</th>
      <th>player_name</th>
      <th>team_id</th>
      <th>team_name</th>
      <th>possession_id</th>
      <th>possession_name</th>
      <th>possession_team_id</th>
      <th>possession_number</th>
      <th>...</th>
      <th>end_y</th>
      <th>gate_x</th>
      <th>gate_y</th>
      <th>opponent_position_id</th>
      <th>opponent_id</th>
      <th>opponent_team_name</th>
      <th>opponent_team_id</th>
      <th>opponent_name</th>
      <th>is_poss_team</th>
      <th>is_att_team</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5135</td>
      <td>1998205_5135</td>
      <td>6121</td>
      <td>Joao Pedro Geraldino dos Santos Galvao</td>
      <td>272</td>
      <td>Cagliari</td>
      <td>1998205___1___5135___5144___no-goal</td>
      <td>Start</td>
      <td>272</td>
      <td>1</td>
      <td>...</td>
      <td>30.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>33</td>
      <td>163764</td>
      <td>Cagliari</td>
      <td>272</td>
      <td>Razvan Gabriel Marin</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5136</td>
      <td>1998205_5136</td>
      <td>163764</td>
      <td>Razvan Gabriel Marin</td>
      <td>272</td>
      <td>Cagliari</td>
      <td>1998205___1___5135___5144___no-goal</td>
      <td>Ball possession</td>
      <td>272</td>
      <td>1</td>
      <td>...</td>
      <td>5.4</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>44</td>
      <td>185339</td>
      <td>Cagliari</td>
      <td>272</td>
      <td>Alessandro Deiola</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5137</td>
      <td>1998205_5137</td>
      <td>185339</td>
      <td>Alessandro Deiola</td>
      <td>272</td>
      <td>Cagliari</td>
      <td>1998205___1___5135___5144___no-goal</td>
      <td>Ball possession</td>
      <td>272</td>
      <td>1</td>
      <td>...</td>
      <td>5.4</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24</td>
      <td>70856</td>
      <td>Inter Milan</td>
      <td>151</td>
      <td>Hakan Calhanoglu</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5139</td>
      <td>1998205_5139</td>
      <td>366890</td>
      <td>Alessandro Bastoni</td>
      <td>151</td>
      <td>Inter Milan</td>
      <td>1998205___1___5135___5144___no-goal</td>
      <td>Ball possession</td>
      <td>272</td>
      <td>1</td>
      <td>...</td>
      <td>9.2</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>32</td>
      <td>3898</td>
      <td>Cagliari</td>
      <td>272</td>
      <td>Diego Roberto Godin Leal</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8346</td>
      <td>1998205_8346</td>
      <td>366890</td>
      <td>Alessandro Bastoni</td>
      <td>151</td>
      <td>Inter Milan</td>
      <td>1998205___1___5135___5144___no-goal</td>
      <td>Ball possession</td>
      <td>272</td>
      <td>1</td>
      <td>...</td>
      <td>8.3</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 43 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Possession-metadata">Possession metadata<a class="anchor-link" href="#Possession-metadata"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <a href="/footSeq/2_possessions_data_structure.html#Possession"><code>Possession</code></a> metadata gives us some information about every possession file saved in the training set. It should help us optimize the file selection process we have in place and better target the training process:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PossessionMetadata" class="doc_header"><code>class</code> <code>PossessionMetadata</code><a href="https://github.com/tkharrat/footSeq/tree/master/footSeq/datastruct/possessions.py#L186" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PossessionMetadata</code>(<strong>*<code>args</code></strong>, <strong>**<code>values</code></strong>) :: <code>Document</code></p>
</blockquote>
<p>Store the <a href="/footSeq/2_possessions_data_structure.html#Possession"><code>Possession</code></a> metadata document info</p>
<h2 id="Attributes">Attributes<a class="anchor-link" href="#Attributes"> </a></h2><p>_id : str
    unique document identifier which is the same as the potential file name
actionEnd, actionStart: int
    event id marking the start and end of the sequence
gameId : int
    game-identifier
possessionNumber : int
    possession number
target : str
    whether the possession ended up in a <code>goal</code> or <code>no-goal</code>
nSeq: int
    total number of time steps in the sequence
attackType: str
    attack type label
standartName: str
    playing type label</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">poss_info</span> <span class="o">=</span> <span class="n">PossessionMetadata</span><span class="o">.</span><span class="n">get_poss_meta</span><span class="p">(</span><span class="n">game_id</span><span class="o">=</span><span class="mi">1098298</span><span class="p">)</span>
<span class="n">poss_info</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>file_id</th>
      <th>game_id</th>
      <th>target</th>
      <th>action_start</th>
      <th>action_end</th>
      <th>n_seq</th>
      <th>possession_number</th>
      <th>attack_type</th>
      <th>standart_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1098298___1___5039___5041___no-goal</td>
      <td>1098298</td>
      <td>no-goal</td>
      <td>5039</td>
      <td>5041</td>
      <td>3</td>
      <td>1</td>
      <td>Positional attack</td>
      <td>Indirect free kick</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1098298___1___5039___5042___no-goal</td>
      <td>1098298</td>
      <td>no-goal</td>
      <td>5039</td>
      <td>5042</td>
      <td>4</td>
      <td>1</td>
      <td>Positional attack</td>
      <td>Indirect free kick</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1098298___1___5039___5043___no-goal</td>
      <td>1098298</td>
      <td>no-goal</td>
      <td>5039</td>
      <td>5043</td>
      <td>5</td>
      <td>1</td>
      <td>Positional attack</td>
      <td>Indirect free kick</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1098298___1___5039___5044___no-goal</td>
      <td>1098298</td>
      <td>no-goal</td>
      <td>5039</td>
      <td>5044</td>
      <td>6</td>
      <td>1</td>
      <td>Positional attack</td>
      <td>Indirect free kick</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1098298___1___5039___5045___no-goal</td>
      <td>1098298</td>
      <td>no-goal</td>
      <td>5039</td>
      <td>5045</td>
      <td>7</td>
      <td>1</td>
      <td>Positional attack</td>
      <td>Indirect free kick</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="The-ActionValue-document">The <code>ActionValue</code> document<a class="anchor-link" href="#The-ActionValue-document"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ActionValues" class="doc_header"><code>class</code> <code>ActionValues</code><a href="https://github.com/tkharrat/footSeq/tree/master/footSeq/datastruct/possessions.py#L248" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ActionValues</code>(<strong>*<code>args</code></strong>, <strong>**<code>values</code></strong>) :: <code>Document</code></p>
</blockquote>
<p>Store the <code>ActionValue</code> document</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

